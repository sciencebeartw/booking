<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±±ç†Šç§‘å­¸ - æ©«å¹…ç”¢ç”Ÿå™¨ (V36.0 é›²ç«¯ç›´é€£ç‰ˆ)</title>
    <!-- å¼•å…¥ html2canvas (æˆªåœ–) -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- å¼•å…¥ TinyMCE (å¼·å¤§ç·¨è¼¯å™¨) -->
    <script src="https://cdn.tiny.cloud/1/2nwvnffdvbvf93d6ry0sov7w0d7yabtr1d6tp8l38cb6hoh1/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <style>
        /* è¼‰å…¥æœ¬åœ°ç«¯çš„è¯åº·å„·é‡‘é»‘ */
        @font-face {
            font-family: 'LiJinHei';
            src: local('è¯åº·å„·é‡‘é»‘ W8-GB5'), local('DFLiKingHei-W8'), url('å„·é‡‘é»‘.ttc');
        }

        :root {
            --bg-green: #025c15; /* é è¨­æ·±ç¶  */
            --bg-blue: #134e70;  /* é è¨­æ·±è— */
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #f0f2f5;
            padding: 20px;
            text-align: center;
            margin: 0;
        }
        h1 { color: #2c3e50; }
        
        .controls {
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            display: inline-block;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .theme-group {
            display: inline-flex;
            align-items: center;
            margin: 0 10px;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        input[type="color"] {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 0;
            background: transparent;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            margin-left: 10px;
            transition: 0.2s;
        }
        
        .btn-green { background-color: var(--bg-green); color: white; } 
        .btn-blue { background-color: var(--bg-blue); color: white; }
        .btn-download { background-color: #e74c3c; color: white; margin-left: 20px;}
        .btn-upload { background-color: #3498db; color: white; } /* æ–°å¢ï¼šé›²ç«¯ä¸Šå‚³æŒ‰éˆ•æ¨£å¼ */
        button:hover { opacity: 0.8; transform: translateY(-2px); }
        button:disabled { background-color: #95a5a6; cursor: not-allowed; transform: none; opacity: 1; }

        /* æ©«å¹…ä¸»é«”è¨­å®š (1200x550) */
        .banner-wrapper {
            margin: 0 auto 50px auto;
            width: 1200px;
            height: 550px; 
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'LiJinHei', "Microsoft JhengHei", sans-serif;
            box-sizing: border-box;
            padding: 15px;
        }

        .banner-wrapper::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('pattern.png'); 
            background-repeat: repeat;
            background-size: 1200px;
            opacity: 1; 
            z-index: 1;
        }

        .banner-content {
            position: relative;
            z-index: 2;
            width: 95%; /* ğŸ‘ˆ é‡‹æ”¾æ©«å‘å¯¬åº¦ï¼Œé¿å…æ–‡å­—æ›è¡Œç ´åœ– */
            text-align: center;
        }

        .theme-green { background-color: var(--bg-green); } 
        .theme-blue { background-color: var(--bg-blue); }

        .banner-header { display: flex; justify-content: space-between; width: 1200px; margin: 0 auto; margin-top: 50px; align-items: center; }
        .banner-header h2 { margin: 0; color: #333; font-family: "Microsoft JhengHei", sans-serif; }
        .action-group { display: flex; gap: 10px; }

        .mce-content-body { outline: none !important; }
        
        .mce-editor-area {
            color: white;
            line-height: 1.4;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>

    <h1>ğŸ» å±±ç†Šç§‘å­¸ - é¦–é æ©«å¹…ç”¢ç”Ÿå™¨èˆ‡é›²ç«¯åœ–åº«</h1>
    <div class="controls">
        <strong style="font-size: 18px; vertical-align: middle;">ä¸»é¡Œåˆ‡æ›èˆ‡èª¿è‰²ï¼š</strong>
        
        <div class="theme-group">
            <input type="color" id="colorGreen" value="#025c15" onchange="updateThemeColor('green', this.value)" title="é»æ“Šæ›´æ”¹ç¶ è‰²">
            <button class="btn-green" onclick="setTheme('theme-green')">åœ‹ä¸­å°éƒ¨ (åˆ‡æ›)</button>
        </div>

        <div class="theme-group">
            <input type="color" id="colorBlue" value="#134e70" onchange="updateThemeColor('blue', this.value)" title="é»æ“Šæ›´æ”¹è—è‰²">
            <button class="btn-blue" onclick="setTheme('theme-blue')">é«˜ä¸­éƒ¨ (åˆ‡æ›)</button>
        </div>

        <button class="btn-download" onclick="downloadAllBanners()">ğŸ“¥ æ‰¹æ¬¡ä¸‹è¼‰å…¨éƒ¨åœ–æª”</button>
        
        <div style="margin-top: 15px; color: #e74c3c; font-size: 15px; text-align: left; padding-left: 10px; line-height: 1.6;">
            ğŸ’¡ <b>æ­¦åº«å…¨é–‹ï¼æŠ€è¡“é•·æ“ä½œæç¤ºï¼š</b><br>
            1. <b>ğŸ§¹ è²¼ä¸Šæ´—ç™½</b>ï¼šå¾ Word è²¼å­—éä¾†è·‘ç‰ˆï¼Ÿé¸èµ·ä¾†é»æ“Š <b>ã€Œæ©¡çš®æ“¦ (æ¸…é™¤æ ¼å¼)ã€</b> ç¬é–“æ´—ç™½ã€‚<br>
            2. <b>ğŸ–¼ï¸ åœ–ç‰‡ç›´è²¼</b>ï¼šæƒ³åŠ æ’åœ–ï¼Ÿç›´æ¥æŠŠå»èƒŒåœ– <b>ã€Œè¤‡è£½è²¼ä¸Šã€</b> æ©«å¹…å…§ï¼Œå¯è‡ªç”±æ‹‰å¤§å°ï¼<br>
            3. <b>ğŸ§® æ•¸ç†ç¬¦è™Ÿ</b>ï¼šé»æ“Š <b>ã€ŒÎ©ã€</b> å¯æ’å…¥ç‰¹æ®Šç¬¦è™Ÿï¼Œé‚„æ”¯æ´ <b>XÂ² (ä¸Šæ¨™)</b>ã€<b>Hâ‚‚O (ä¸‹æ¨™)</b>ã€‚<br>
            4. <b>ğŸ“Š éš±å½¢è¡¨æ ¼</b>ï¼šæ’ç‰ˆå°ä¸é½Šï¼Ÿé»æ“Š <b>ã€Œè¡¨æ ¼åœ–ç¤ºã€</b> ç•«æ ¼å­ï¼Œå­—å¡é€²å»çµ•å°åˆ‡é½Šï¼<br>
            5. <b>â˜ï¸ é›²ç«¯äº’é€š</b>ï¼šé»æ“Šã€Œå­˜å…¥é›²ç«¯åœ–åº«ã€ï¼Œæœªä¾†å³å¯åœ¨å¾Œå°ç›´æ¥å¥—ç”¨ï¼
        </div>
    </div>

    <!-- æ©«å¹… 1ï¼šä¸»è¦–è¦ºèˆ‡æ™‚é–“ -->
    <div class="banner-header">
        <h2>åœ– 1ï¼šä¸»è¦–è¦ºèˆ‡æ™‚é–“ (é˜²æŠ˜è¡Œå®Œç¾ç‰ˆ)</h2>
        <div class="action-group">
            <button class="btn-download" onclick="downloadBanner('banner1', 'ä¸»è¦–è¦ºæ©«å¹…')">ğŸ“¥ ä¸‹è¼‰</button>
            <button class="btn-upload" onclick="uploadBannerToCloud('banner1', 'ä¸»è¦–è¦ºæ©«å¹…')">â˜ï¸ å­˜å…¥é›²ç«¯åœ–åº«</button>
        </div>
    </div>
    <div id="banner1" class="banner-wrapper theme-green">
        <div class="banner-content mce-editor-area">
            <div style="font-size: 65px; margin-bottom: 10px;">å‡å°äº”<span style="color: #f8a95b;">é‚è¼¯æ•¸å­¸</span>èª²ç¨‹</div>
            <div style="font-size: 60px; margin-bottom: 10px;">é–‹æ”¾åŠƒä½ï¼š6/12</div>
            <div style="font-size: 85px; font-weight: bold; margin-bottom: 15px; letter-spacing: 2px;">19:00-20:00 21:00-22:00</div>
            <div style="font-size: 28px; margin-bottom: 10px;">*<span style="color: #f8a95b;">é‡è¤‡åŠƒä½</span>åŠ<span style="color: #f8a95b;">ç„¡æ•ˆé‡‹å‡º</span>åº§ä½å°‡æ–¼ 21:00 é‡‹å‡ºï¼ŒåŒæ™‚é–‹æ”¾<span style="color: #f8a95b;">å€™è£œ</span>é¸é …ã€‚</div>
            <div style="font-size: 24px; line-height: 1.5;">*è«‹é å…ˆæ¸¬è©¦ä¸¦ä»”ç´°æ ¸å°ä¸Šèª²ç§‘ç›®åŠæ™‚é–“ã€€ã€€*åŠƒä½æ™‚é–“åˆ°å…åˆ· F5ï¼ŒæŒ‰éˆ•è‡ªå‹•è®Šç¶ <br>*è«‹æ³¨æ„ï¼è³¼è²·äººå§“åè«‹å¡«å­¸ç”Ÿå§“åã€€ã€€*è‹¥å› è³‡æ–™éŒ¯å¡«è€Œç„¡æ³•ç¢ºèªå ±åè€…å°‡ç„¡æ•ˆé‡‹å‡º</div>
        </div>
    </div>

    <!-- æ©«å¹… 2ï¼šæˆ°è¡“æŒ‡å— -->
    <div class="banner-header">
        <h2>åœ– 2ï¼šæˆ°è¡“æŒ‡å— (é˜²æ“ å£“å®Œç¾ç‰ˆ)</h2>
        <div class="action-group">
            <button class="btn-download" onclick="downloadBanner('banner2', 'æˆ°è¡“æŒ‡å—æ©«å¹…')">ğŸ“¥ ä¸‹è¼‰</button>
            <button class="btn-upload" onclick="uploadBannerToCloud('banner2', 'æˆ°è¡“æŒ‡å—æ©«å¹…')">â˜ï¸ å­˜å…¥é›²ç«¯åœ–åº«</button>
        </div>
    </div>
    <div id="banner2" class="banner-wrapper theme-green">
        <div class="banner-content mce-editor-area">
            <div style="font-size: 55px; color: #f8a95b; margin-bottom: 25px;">âš¡ åŠƒä½æˆ°è¡“çµ‚æ¥µæŒ‡å— âš¡</div>
            <div style="background: rgba(0,0,0,0.4); padding: 35px 45px; border-radius: 20px; display: inline-block; text-align: left; font-size: 32px; line-height: 1.6; letter-spacing: 1px;">
                <div style="margin-bottom: 12px;">âœ… å…åˆ· F5ï¼ç³»çµ±æ™‚é–“ä¸€åˆ°ï¼Œé¦–é æŒ‰éˆ•å°‡è‡ªå‹•äº®èµ·ç¶ ç‡ˆã€‚</div>
                <div style="margin-bottom: 12px;">ğŸ›¡ï¸ é»åˆ°å³é–å®šï¼ç³»çµ±å°‡çµ¦äºˆæ‚¨å°ˆå±¬çš„ 90 ç§’å¾å®¹å¡«å¯«è³‡æ–™ã€‚</div>
                <div style="color: #ff9999;">ğŸš« åš´ç¦ç„¡ç—•æ¨¡å¼ï¼ä½¿ç”¨ç„¡ç—•æˆ–å¤–æ›å°‡è§¸ç™¼åœ°ç„ç´šåœ–ç‰‡é©—è­‰ï¼</div>
            </div>
            <div style="font-size: 24px; color: #ffcccc; margin-top: 25px;">*ç‚ºæ±‚å…¬å¹³ï¼ŒåŒä¸€è£ç½®åŒæ™‚åƒ…èƒ½ä½”ç”¨ä¸€å¸­åº§ä½ï¼Œå¤šå¯¶å®¶åº­è«‹ä½¿ç”¨å¤šå°è£ç½®åˆ†æµã€‚</div>
        </div>
    </div>

    <!-- æ©«å¹… 3ï¼šåŠƒä½å¾Œçš„ä¸‹ä¸€æ­¥ -->
    <div class="banner-header">
        <h2>åœ– 3ï¼šåŠƒä½æˆåŠŸå¾Œçš„ä¸‹ä¸€æ­¥</h2>
        <div class="action-group">
            <button class="btn-download" onclick="downloadBanner('banner3', 'ç¹³è²»æé†’æ©«å¹…')">ğŸ“¥ ä¸‹è¼‰</button>
            <button class="btn-upload" onclick="uploadBannerToCloud('banner3', 'ç¹³è²»æé†’æ©«å¹…')">â˜ï¸ å­˜å…¥é›²ç«¯åœ–åº«</button>
        </div>
    </div>
    <div id="banner3" class="banner-wrapper theme-green">
        <div class="banner-content mce-editor-area">
            <div style="font-size: 55px; color: #f8a95b; margin-bottom: 25px;">ğŸ’° åŠƒä½æˆåŠŸå¾Œçš„ä¸‹ä¸€æ­¥</div>
            <div style="background: rgba(0,0,0,0.4); padding: 35px 45px; border-radius: 20px; display: inline-block; text-align: left; font-size: 32px; line-height: 1.6; letter-spacing: 1px;">
                <div style="margin-bottom: 12px;"><span style="color: #2ecc71;">â¶</span> è«‹å‹™å¿…æˆªåœ–ä¿å­˜æ‚¨çš„ã€Œè¨‚å–®ç·¨è™Ÿã€èˆ‡ã€Œåº§ä½ã€</div>
                <div style="margin-bottom: 12px;"><span style="color: #2ecc71;">â·</span> ä¸»å‹•å‚³ LINE (@bearhigh) å‘ŠçŸ¥æˆ‘å€‘ã€Œå­¸ç”Ÿå§“åã€</div>
                <div><span style="color: #2ecc71;">â¸</span> ç­‰å€™æ«ƒæª¯ç¢ºèªç„¡èª¤å¾Œï¼Œç™¼é€å°ˆå±¬å­¸è²»å–®çµ¦æ‚¨</div>
            </div>
            <div style="font-size: 24px; color: #ffcccc; margin-top: 25px;">*è«‹æ–¼æ”¶åˆ°å­¸è²»å–®å¾Œ 3 æ—¥å…§å®Œæˆç¹³è²»ï¼Œé€¾æœŸç³»çµ±å°‡ç„¡æƒ…é‡‹å‡ºçµ¦å€™è£œåŒå­¸å“¦ï¼</div>
        </div>
    </div>

    <!-- â˜…â˜…â˜… å¼•å…¥ Firebase èˆ‡æ¨¡çµ„åŒ–è…³æœ¬ â˜…â˜…â˜… -->
    <script type="module">
        import { db, ref as dbRef, push, set, storage, storageRef, uploadBytes, getDownloadURL } from './firebase-config.js';

        let adminSessionPwd = ""; // æš«å­˜å¯†ç¢¼ï¼Œä¸ç”¨æ¯æ¬¡æ‰“

        tinymce.init({
            selector: '.mce-editor-area',
            inline: true,
            paste_data_images: true, 
            plugins: 'lists link code charmap image table', 
            toolbar: 
                'undo redo removeformat | ' +               
                'fontfamily fontsize lineheight | ' +       
                'bold italic underline strikethrough | ' +  
                'superscript subscript charmap | ' +        
                'forecolor backcolor | ' +                  
                'alignleft aligncenter alignright | ' +     
                'image table code',                         
                
            font_family_formats: 'è¯åº·å„·é‡‘é»‘=LiJinHei; å¾®è»Ÿæ­£é»‘é«”="Microsoft JhengHei"; Arial=arial,helvetica,sans-serif;',
            font_size_formats: '16px 20px 24px 28px 32px 36px 48px 55px 60px 65px 70px 80px 85px 105px 120px'
        });

        // ç¶å®šåˆ° window è®“ HTML onclick å¯ä»¥å‘¼å«
        window.updateThemeColor = function(theme, colorHex) {
            document.documentElement.style.setProperty(`--bg-${theme}`, colorHex);
        }

        window.setTheme = function(themeClass) {
            const banners = document.querySelectorAll('.banner-wrapper');
            banners.forEach(banner => {
                banner.classList.remove('theme-green', 'theme-blue');
                banner.classList.add(themeClass);
            });
        }

        window.downloadBanner = function(bannerId, filename) {
            tinymce.triggerSave();
            tinymce.activeEditor.getBody().blur();
            
            setTimeout(() => {
                const element = document.getElementById(bannerId);
                html2canvas(element, { scale: 2, backgroundColor: null, useCORS: true }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `${filename}.png`;
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                });
            }, 200);
        }

        window.downloadAllBanners = async function() {
            tinymce.activeEditor.getBody().blur();
            alert("é–‹å§‹ç”¢ç”Ÿåœ–ç‰‡ï¼Œè«‹ç¨å€™...");
            await new Promise(r => setTimeout(r, 500)); 
            
            const ids = ['banner1', 'banner2', 'banner3'];
            const names = ['ä¸»è¦–è¦ºæ©«å¹…', 'æˆ°è¡“æŒ‡å—æ©«å¹…', 'ç¹³è²»æé†’æ©«å¹…'];

            for (let i = 0; i < ids.length; i++) {
                const element = document.getElementById(ids[i]);
                await html2canvas(element, { scale: 2, backgroundColor: null, useCORS: true }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `${names[i]}.png`;
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                });
                await new Promise(r => setTimeout(r, 500)); 
            }
        }

        // â˜…â˜…â˜… æ ¸å¿ƒä¸Šå‚³é‚è¼¯ï¼šä¸€éµä¸Šå‚³è‡³ Firebase Storage èˆ‡ Database â˜…â˜…â˜…
        window.uploadBannerToCloud = async function(bannerId, defaultName) {
            if (!adminSessionPwd) {
                let pwd = prompt("ğŸ”’ ç³»çµ±å®‰å…¨é–ï¼š\nè«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ä»¥ä¸Šå‚³è‡³é›²ç«¯åœ–åº«ï¼š");
                if (!pwd || !pwd.trim()) return;
                adminSessionPwd = pwd.trim();
            }

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = "â³ é­”æ³•é€£ç·šä¸­...";
            btn.disabled = true;

            try {
                // 1. é—œé–‰ç·¨è¼¯å™¨æ¸¸æ¨™
                tinymce.triggerSave();
                tinymce.activeEditor.getBody().blur();
                await new Promise(r => setTimeout(r, 200));

                // 2. æˆªåœ–è½‰ç‚º Blob (äºŒé€²ä½åœ–ç‰‡æª”)
                const element = document.getElementById(bannerId);
                const canvas = await html2canvas(element, { scale: 2, backgroundColor: null, useCORS: true });
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));

                // 3. è©¢å•å­˜æª”åç¨±
                const saveName = prompt("è«‹ç‚ºé€™å¼µæ©«å¹…å‘½åï¼ˆé€™æœƒé¡¯ç¤ºåœ¨å¾Œå°åœ–åº«ä¸­ï¼‰ï¼š", defaultName + "_" + new Date().toLocaleDateString('zh-TW'));
                if (!saveName) {
                    btn.textContent = originalText;
                    btn.disabled = false;
                    return;
                }
                
                btn.textContent = "â˜ï¸ é›²ç«¯ä¸Šå‚³ä¸­...";

                // 4. ä¸Šå‚³åœ–ç‰‡åˆ° Storage
                const fileName = `banner_gallery/${Date.now()}_${bannerId}.png`;
                const sRef = storageRef(storage, fileName);
                await uploadBytes(sRef, blob, { contentType: 'image/png' });
                const url = await getDownloadURL(sRef);

                // 5. å¯«å…¥ Database ç´€éŒ„
                const newDocRef = push(dbRef(db, 'banner_gallery'));
                await set(newDocRef, {
                    name: saveName,
                    url: url,
                    createdAt: Date.now(),
                    adminPwd: adminSessionPwd
                });

                alert(`âœ… æˆåŠŸå­˜å…¥é›²ç«¯åœ–åº«ï¼\nåœ–æª”åï¼š${saveName}\næ‚¨ç¾åœ¨å¯ä»¥åœ¨å¾Œå°ç›´æ¥æŒ‘é¸å®ƒäº†ã€‚`);
            } catch (error) {
                console.error(error);
                alert("âŒ ä¸Šå‚³å¤±æ•—ï¼Œå¯èƒ½æ˜¯å¯†ç¢¼éŒ¯èª¤æˆ–ç¶²è·¯å•é¡Œï¼š" + error.message);
                adminSessionPwd = ""; // å¯†ç¢¼éŒ¯èª¤å°±æ¸…ç©ºé‡ä¾†
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>